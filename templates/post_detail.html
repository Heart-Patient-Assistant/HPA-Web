{% extends 'base.html'%}
{% load static %}
{%block title%}
  {{ post.title_tag }}
{%endblock title%}

{% block content %}
  <div class="post-entry">
    <h2>{{ post.title }}</h2>
    <small><p>Posted By : {{post.author}}</p></small>
    <small><a href="{% url 'blogs:category' post.category %}">{{post.category}}</a></small> | <small>{{post.post_date}}</small> <br> <hr>
    <p>{{ post.body }}</p>
    {% if post.header_image %}
      <img src="{{post.header_image.url}}" alt="post_image" width="500" height="300"> <br><br>
    {% endif %}
  </div>
  {% if user.id == post.author.id %}
    <small><p><a href="{% url 'blogs:post_edit' post.pk %}">+Edit Blog Post</a></p></small>
    <small><p><a href="{% url 'blogs:post_delete' post.pk %}">+Delete Blog Post</a></p></small>
  {% endif%}
  <hr>
  <form action="{% url 'blogs:like_post' post.pk%}" method="POST">
    {% csrf_token %}

    {% if user.is_authenticated%}
      {% if liked %}
      <button type='submit' name='post_id' value="{{post.id}}" class='btn btn-danger
      btn-sm'>Unlike</button>
      {% else %}
      <button type='submit' name='post_id' value="{{post.id}}" class='btn btn-primary
      btn-sm'>Like</button>
      {% endif %}
    {% else %}
      <small><a href="{% url 'login'%}">Log In </a>to like</small>
    {% endif %}

     -- {{total_likes}} Likes
  </form>
  <hr>
  <div class="card mb-3">
    <div class="row no-gutters">
      <div class="col-md-2">
        {% if post.author.profile.profile_pic  %}
          <img src="{{ post.author.profile.profile_pic.url }}" class="card-img" alt="profile_picture" width="200" height="200">
        {% else %}
          <img src="{% static 'theblog\images\Unknown_person.jpg' %}" class="card-img" alt="profile_picture" width="100" height="150">
        {% endif %}
      </div>
      <div class="col-md-10">
        <div class="card-body">
          <h5 class="card-title">
            {{ post.author.first_name }}
            {{ post.author.last_name }}
          </h5>
          <p class="card-text">{{ post.author.profile.bio }}</p>
          <p class="small text-muted">
            <a href="{% url 'users:show_profile' post.author.profile.id %}">Profile Page</a> |
            {% if post.author.profile.website_url %}
              <a href="{{post.author.profile.website_url}}"> Website</a>
            {% endif %}
          </p>
          <p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>
        </div>
      </div>
    </div>
  </div>
  <h2>Comments..</h2>
  {% if not post.comments.all %}
    <p>No Comments Yet.. <a href="{% url 'blogs:add_comment' post.pk %}">Add One</a></p>
  {% else %}
  <a href="{% url 'blogs:add_comment' post.pk %}">Add Comment</a><br>
    {% for comment in post.comments.all reversed %}
      <strong>{{comment.name}} - {{comment.date_added}}</strong> <br>
      {{comment.body}}
      <br><br>
    {% endfor %}
  {% endif %}
{% endblock content %}
